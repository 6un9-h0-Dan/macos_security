rule_id: MSCP RULE
title: The macOS system must implement an approved Key Exchange Algorithm.
discussion: 'Unapproved mechanisms for authentication to the cryptographic module
  are not verified, and therefore cannot be relied upon to provide confidentiality
  or integrity, resulting in the compromise of DoD data.


  Operating systems using encryption are required to use FIPS-compliant mechanisms
  for authenticating to cryptographic modules.


  The implementation of OpenSSH that is included with macOS does not utilize a FIPS
  140-2 validated cryptographic module. While the listed Key Exchange Algorithms are
  FIPS 140-2 approved, the module implementing them has not been validated.


  By specifying a Key Exchange Algorithm list with the order of hashes being in a
  "strongest to weakest" orientation, the system will automatically attempt to use
  the strongest Key Exchange Algorithm for securing SSH connections.


  '
check: ''
result: '['''', ''KexAlgorithms diffie-hellman-group-exchange-sha256'', '''', ''If
  any algorithm other than "diffie-hellman-group-exchange-sha256" is listed or the
  "KexAlgorithms" keyword is missing, this is a finding.'']'
fix: 'Configure SSH to use a secure Key Exchange Algorithm.


  To ensure that "KexAlgorithms" set correctly, run the following command:


  /usr/bin/sudo /usr/bin/grep -q ''^KexAlgorithms'' /etc/ssh/sshd_config && /usr/bin/sudo
  /usr/bin/sed -i.bak ''s/^KexAlgorithms.*/KexAlgorithms diffie-hellman-group-exchange-sha256/''
  /etc/ssh/sshd_config || /usr/bin/sudo /usr/bin/sed -i.bak ''/.*Ciphers and keying.*/a\''$''\nKexAlgorithms
  diffie-hellman-group-exchange-sha256''$''\n'' /etc/ssh/sshd_config


  The SSH service must be restarted for changes to take effect.'
references:
  srg:
  - SRG-OS-000033-GPOS-00014
  - SRG-OS-000120-GPOS-00061
  - SRG-OS-000125-GPOS-00065
  - SRG-OS-000250-GPOS-00093
  - SRG-OS-000393-GPOS-00173
  - SRG-OS-000394-GPOS-00174
  disa_stig:
  - APPL-12-000056
  cci:
  - CCI-000803
  - CCI-000068
  - CCI-002890
  - CCI-003123
macOS:
- '12'
tags:
- stig
severity: medium
